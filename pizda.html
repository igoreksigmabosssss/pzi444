<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–ª—É—á–∏—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js?1"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: white;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 24px;
        }

        .description {
            color: #666;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .phone-display {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 30px 0;
            display: none;
        }

        .phone-display.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .phone-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .phone-number {
            color: #333;
            font-size: 24px;
            font-weight: 600;
            direction: ltr;
        }

        .phone-icon {
            font-size: 40px;
            margin-bottom: 10px;
            color: #4CAF50;
        }

        .request-button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 18px 30px;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .request-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .request-button:active {
            transform: translateY(0);
        }

        .request-button.loading {
            opacity: 0.8;
            cursor: not-allowed;
        }

        .button-icon {
            font-size: 24px;
        }

        .info-box {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            text-align: left;
            font-size: 14px;
            color: #1976d2;
        }

        .info-icon {
            margin-right: 8px;
        }

        .status-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 10px;
            font-size: 14px;
            display: none;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            display: block;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .instructions {
            background: #fff8e1;
            border-radius: 10px;
            padding: 15px;
            margin-top: 25px;
            font-size: 14px;
            color: #5d4037;
            text-align: left;
        }

        .step {
            margin-bottom: 10px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .step-number {
            background: #ff9800;
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            flex-shrink: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">üì±</div>
        
        <h1>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–∞</h1>
        <p class="description">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —á–µ—Ä–µ–∑ Telegram</p>
        
        <div class="phone-display" id="phoneDisplay">
            <div class="phone-icon">‚úÖ</div>
            <div class="phone-label">–í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:</div>
            <div class="phone-number" id="phoneNumber">+7 (XXX) XXX-XX-XX</div>
        </div>
        
        <button class="request-button" id="requestButton">
            <span class="button-icon">üì±</span>
            <span id="buttonText">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º</span>
        </button>
        
        <div class="status-message" id="statusMessage"></div>
        
        <div class="instructions">
            <div class="step">
                <div class="step-number">1</div>
                <div>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º"</div>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <div>–í –ø–æ—è–≤–∏–≤—à–µ–º—Å—è –æ–∫–Ω–µ Telegram –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫—É –Ω–æ–º–µ—Ä–∞</div>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <div>–í–∞—à –Ω–æ–º–µ—Ä –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—Å—è –Ω–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ</div>
            </div>
        </div>
        
        <div class="info-box">
            <span class="info-icon">‚ÑπÔ∏è</span>
            –í–∞—à –Ω–æ–º–µ—Ä –±—É–¥–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω —Ç–æ–ª—å–∫–æ —ç—Ç–æ–º—É –±–æ—Ç—É –∏ –Ω–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Å–ø–∞–º–∞
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.MainButton.hide();
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const requestButton = document.getElementById('requestButton');
        const buttonText = document.getElementById('buttonText');
        const phoneDisplay = document.getElementById('phoneDisplay');
        const phoneNumber = document.getElementById('phoneNumber');
        const statusMessage = document.getElementById('statusMessage');
        
        // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL (–µ—Å–ª–∏ –Ω–æ–º–µ—Ä —É–∂–µ –ø–µ—Ä–µ–¥–∞–Ω)
        const urlParams = new URLSearchParams(window.location.search);
        const phoneParam = urlParams.get('phone');
        
        // –ï—Å–ª–∏ –Ω–æ–º–µ—Ä —É–∂–µ –ø–µ—Ä–µ–¥–∞–Ω —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä URL
        if (phoneParam) {
            showPhoneNumber(phoneParam);
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É
        requestButton.addEventListener('click', requestPhoneNumber);
        
        // –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        function requestPhoneNumber() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–∞ –∫–æ–Ω—Ç–∞–∫—Ç–∞
            if (!tg.requestContact) {
                showError('–í–∞—à–∞ –≤–µ—Ä—Å–∏—è Telegram –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é. –û–±–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            requestButton.classList.add('loading');
            buttonText.textContent = '–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω...';
            
            // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∫–æ–Ω—Ç–∞–∫—Ç
            tg.requestContact((contact) => {
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–∞
                handleContactReceived(contact);
            }, (error) => {
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
                handleContactError(error);
            });
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞
        function handleContactReceived(contact) {
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
            requestButton.classList.remove('loading');
            buttonText.textContent = '–ù–æ–º–µ—Ä –ø–æ–ª—É—á–µ–Ω!';
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
            const formattedPhone = formatPhoneNumber(contact.phone_number);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–º–µ—Ä
            showPhoneNumber(formattedPhone);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
            showSuccess('–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω!');
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É —á–µ—Ä–µ–∑ Telegram WebApp
            sendDataToBot(contact);
            
            // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç –∫–Ω–æ–ø–∫–∏ –Ω–∞ –∑–µ–ª–µ–Ω—ã–π
            requestButton.style.background = 'linear-gradient(135deg, #4CAF50, #2E7D32)';
            requestButton.disabled = true;
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
        function handleContactError(error) {
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
            requestButton.classList.remove('loading');
            buttonText.textContent = '–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
            showError('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–º–µ—Ä. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
            console.error('Contact request error:', error);
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        function showPhoneNumber(phone) {
            phoneNumber.textContent = phone;
            phoneDisplay.classList.add('show');
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        function formatPhoneNumber(phone) {
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã
            const cleaned = phone.replace(/\D/g, '');
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–ª–∏–Ω—ã
            if (cleaned.length === 11 && cleaned.startsWith('7')) {
                return `+7 (${cleaned.substring(1, 4)}) ${cleaned.substring(4, 7)}-${cleaned.substring(7, 9)}-${cleaned.substring(9)}`;
            } else if (cleaned.length === 12 && cleaned.startsWith('7')) {
                return `+7 (${cleaned.substring(1, 4)}) ${cleaned.substring(4, 7)}-${cleaned.substring(7, 9)}-${cleaned.substring(9)}`;
            } else if (cleaned.length === 10) {
                return `+7 (${cleaned.substring(0, 3)}) ${cleaned.substring(3, 6)}-${cleaned.substring(6, 8)}-${cleaned.substring(8)}`;
            }
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä, –µ—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω
            return phone;
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
        function showSuccess(message) {
            statusMessage.textContent = message;
            statusMessage.className = 'status-message success';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        function showError(message) {
            statusMessage.textContent = message;
            statusMessage.className = 'status-message error';
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É
        function sendDataToBot(contact) {
            // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç —Å –¥–∞–Ω–Ω—ã–º–∏
            const data = {
                action: 'phone_received',
                phone: contact.phone_number,
                formatted_phone: formatPhoneNumber(contact.phone_number),
                first_name: contact.first_name || '',
                last_name: contact.last_name || '',
                user_id: contact.user_id || tg.initDataUnsafe.user?.id,
                timestamp: new Date().toISOString()
            };
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É —á–µ—Ä–µ–∑ Telegram WebApp
            try {
                tg.sendData(JSON.stringify(data));
                console.log('–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –±–æ—Ç—É:', data);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É:', error);
            }
            
            // –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–º–µ—Ä –≤ localStorage
            localStorage.setItem('user_phone', contact.phone_number);
            localStorage.setItem('phone_received', new Date().toISOString());
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –Ω–æ–º–µ—Ä
        window.addEventListener('DOMContentLoaded', () => {
            const savedPhone = localStorage.getItem('user_phone');
            if (savedPhone && !phoneParam) {
                showPhoneNumber(formatPhoneNumber(savedPhone));
                buttonText.textContent = '–ù–æ–º–µ—Ä —É–∂–µ –ø–æ–ª—É—á–µ–Ω';
                requestButton.style.background = 'linear-gradient(135deg, #4CAF50, #2E7D32)';
                requestButton.disabled = true;
                showSuccess('–ù–æ–º–µ—Ä –±—ã–ª –ø–æ–ª—É—á–µ–Ω —Ä–∞–Ω–µ–µ');
            }
            
            // –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
            console.log('Telegram WebApp initialized:', {
                version: tg.version,
                platform: tg.platform,
                initData: tg.initData,
                initDataUnsafe: tg.initDataUnsafe
            });
        });
    </script>
</body>
</html>